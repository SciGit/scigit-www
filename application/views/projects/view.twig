{% extends "base.twig" %}

{% block title project.name %}

{% block content %}

{% include 'projects/member_add.twig' with {project: project} %}

<p class="breadcrumbs">
  {{ anchor("/", "Home") | raw }} <span class="divider">&gt;</span>
  {% if member or admin %}
    {{ anchor("/projects", "My Projects") | raw }} <span class="divider">&gt;</span>
  {% else %}
    {{ anchor("/projects/explore", "Public") | raw }} <span class="divider">&gt;</span>
  {% endif %}
  <span class="current">{{ anchor("/projects/view/#{project.id}", project.name) | raw }}</span>
</p>

<div class="separator-xsmall"></div>

<div class="page-header">
  <h1>
    <div class="pull-right">
      {% if admin %}
        <a class="btn btn-large btn-primary" href="{{ site_url("/projects/admin/#{project.id}") | raw }}">
          <i class="icon-wrench icon-white"></i>
          Settings
        </a>
      {% elseif not member %}
        {{ form_open("/projects/subscribe/#{project.id}") | raw }}
          {{ form_input({class: 'hidden', name: 'return_to', value: 'view'}) | raw }}
          {{ form_submit({class: subscribed ? 'btn btn-large btn-danger' : 'btn btn-large btn-success', name: 'subscribe'},
              subscribed ? 'Unsubscribe' : 'Subscribe') | raw }}
        {{ form_close() | raw }}
      {% endif %}
    </div>
    {{ project.name }}
  </h1>
</div>

<div class="row-fluid">
  <div class="span4">
    <div class="blue-well-list">
      <table class="table table-condensed">
        <tr>
          <th>
            <h2>
              {% if admin %}
                <div class="pull-right">
                  <a id="btnEditDescription" class="btn btn-valign center" href="#" rel="tooltip" title="Edit description">
                    <i class="icon-large icon-edit"></i> Edit
                  </a>
                </div>
              {% endif %}
              Description
            </h2>
          </th>
        </tr>
        <tr>
          <td class="tabular" valign="middle">
            <p id="description">
              {% if project.description %}
                {{ word_wrap(project.description, 30) }}
              {% else %}
                <p>This project has no description.</p>
              {% endif %}
            </p>
            {{ form_open("/projects/admin/#{project.id}", {id: "editDescription", class: "hide"}) | raw }}
              {{ form_textarea({class: "full-width-input", name: "description", value: project.description}) | raw }}
              <a href="#" onclick="$('#editDescription').submit();" class="btn btn-primary pull-right">Save</a>
            {{ form_close() | raw }}
          </td>
        </tr>
      </table>
    </div>
    <div class="well-list">
      <table class="table table-hover table-condensed">
        <tr>
          <th>
            <h2>
              Members
              {% if admin %}
                <div class="pull-right">
                  <a href="#addMember" rel="tooltip" title="Add new member" class="btn btn-valign" data-toggle="modal">
                    <i class="icon-plus"></i> Add
                  </a>
                </div>
              {% endif %}
            </h2>
          </th>
        </tr>
        {% for perm in perms %}
          <tr>
            <td class="tabular" valign="middle">
              <div class="statuses">
                <div class="status">
                  {% if perm.permission b-and 16 %}
                    <a class="rawlink" rel="tooltip" title="Owner">
                      <i class="icon-trophy"></i>
                    </a>
                  {% elseif perm.permission b-and 8 %}
                    <a class="rawlink" rel="tooltip" title="Administrator">
                      <i class="icon-wrench"></i>
                    </a>
                  {% elseif perm.permission b-and 4 %}
                    <a class="rawlink" rel="tooltip" title="Contributor">
                      <i class="icon-edit"></i>
                    </a>
                  {% elseif perm.permission b-and 2 %}
                    <a class="rawlink" rel="tooltip" title="Reader">
                      <i class="icon-eye-open"></i>
                    </a>
                  {% endif %}
                </div>
              </div>
              {{ anchor("/users/profile/#{perm.user_id}", perm.username) | raw }}
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
    <div class="well-list">
      <table class="table table-condensed">
        <tr>
          <th colspan="2">
            <h2>Stats</h2>
          </th>
        </tr>
        <tr>
          <td class="stats">
            <div class="row-fluid">
              <div class="span4">
                <h3>{{ subscribers }}</h3>
                <p>Subscribers</p>
              </div>
              <div class="span4">
                <h3>{{ administrators }}</h3>
                <p>Administrators</p>
              </div>
              <div class="span4">
                <h3>{{ contributors }}</h3>
                <p>Contributors</p>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span4">
                <h3>{{ changes_num }}</h3>
                <p>Updates</p>
              </div>
              <div class="span8">
                <h3>{{ project.created_ts | date("Y-m-d") }}</h3>
                <p>Created</p>
              </div>
            </div>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="span8">
    {% include 'projects/changes_list.twig' %}
  </div>
</div>

{% endblock %}
