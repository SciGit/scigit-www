{% extends "base.twig" %}

{% block title project.name %}

{% block content %}

<script>
  var usernames = ['dsherk', 'ericho', 'hansonw', 'tammyt'];

  $(document).ready(function() {
    $('#user-invite').typeahead(
      {source: usernames}
    );

    function validateUser(field) {
      if (usernames.indexOf(field.value) > -1) {
        alert('yes');
      }
    }

    $('#user-invite').live('change', function() {
      validateUser(this);
    });
    $('#user-invite').live('change keypress', function() {
      validateUser(this);
    });

    function validateEmail(field) {
      var re = /\S+@\S+\.\S+/;
      if (re.test(field.value)) {
        alert('yes');
      }
    }

    $('#email-invite').live('change', function() {
      validateEmail(this);
    });
    $('#email-invite').live('change keypress', function() {
      validateEmail(this);
    });
  })
</script>

<div id="addContributor" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h2>Add Contributor</h2>
  </div>
  <div class="modal-body">
    <div class="row-fluid">
      <div class="span6 center well">
        <h3>Find User</h3>
        <p></p>
        <p>Does the contributor you want to add already have a SciGit account? Search for them here.</p>
        <br />
        <p>Enter a username.</p>
        {{ form_open("/projects/invite/#{project.id}") | raw }}
          {{ form_input({id: 'user-invite', class: 'full-width-input', name: 'invite', maxlength: 40}) | raw }}
        {{ form_close() | raw }}
      </div>
      <div class="span6 center well">
        <h3>Invite to SciGit</h3>
        <p></p>
        <p>Invite someone to SciGit! Once they've joined, they'll automatically be added to your project.</p>
        <br />
        <p>Enter an email.</p>
        {{ form_open("/users/invite/#{project.id}") | raw }}
          {{ form_input({id: 'email-invite', class: 'full-width-input', name: 'invite', maxlength: 40}) | raw }}
        {{ form_close() | raw }}
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <a class="btn btn-primary" data-dismiss="modal">Close</a>
  </div>
</div>

<p class="breadcrumbs">
  {{ anchor("/", "Home") | raw }} <span class="divider">&gt;</span>
  {% if member or admin %}
    {{ anchor("/projects", "My Projects") | raw }} <span class="divider">&gt;</span>
  {% else %}
    {{ anchor("/projects/explore", "Public") | raw }} <span class="divider">&gt;</span>
  {% endif %}
  <span class="current">{{ anchor("/projects/view/#{project.id}", project.name) | raw }}</span>
</p>

<div class="separator-xsmall"></div>

<div class="page-header">
  <h1>
    <div class="pull-right">
      {% if admin %}
        <a class="btn btn-large btn-primary title-btn" href="{{ site_url("/projects/admin/#{project.id}") | raw }}">
          <i class="icon-wrench icon-white"></i>
          Settings
        </a>
      {% elseif not member %}
        {{ form_open("/projects/subscribe/#{project.id}") | raw }}
          {{ form_input({class: 'hidden', name: 'return_to', value: 'view'}) | raw }}
          {{ form_submit({class: subscribed ? 'btn btn-large btn-danger' : 'btn btn-large btn-success', name: 'subscribe'},
              subscribed ? 'Unsubscribe' : 'Subscribe') | raw }}
        {{ form_close() | raw }}
      {% endif %}
    </div>
    {{ project.name }}
  </h1>
</div>

<div class="row-fluid">
  <div class="span4">
    <div class="blue-well-list">
      <table class="table table-condensed">
        <tr>
          <th>
            <h2>Description</h2>
          </th>
        </tr>
        <tr class="nohover">
          <td class="tabular" valign="middle">
            <p>
              {% if project.description %}
                {{ word_wrap(project.description, 30) }}
              {% else %}
                <p>This project has no description.</p>
              {% endif %}
            </p>
          </td>
        </tr>
      </table>
    </div>
    <div class="well-list">
      <table class="table table-condensed">
        <tr>
          <th colspan="2">
            <h2>Stats</h2>
          </th>
        </tr>
        <tr class="nohover">
          <td class="tabular" valign="middle">
            <p><i class="icon-star"></i>&nbsp;&nbsp;<strong>{{ subscribers }}</strong> Subscribers</p>
          </td>
          <td class="tabular" valign="middle">
            <p><i class="icon-circle-arrow-up"></i>&nbsp;&nbsp;<strong>{{ changes_num }}</strong> Updates</p>
          </td>
        </tr>
        <tr class="nohover">
          <td class="tabular" valign="middle">
            <p><i class="icon-edit"></i>&nbsp;&nbsp;<strong>{{ contributors }}</strong> Contributors</p>
          </td>
          <td class="tabular" valign="middle">
            <p><i class="icon-wrench"></i>&nbsp;&nbsp;<strong>{{ administrators }}</strong> Administrators</p>
          </td>
        </tr>
        <tr class="alwayshover">
          <td colspan="2">
            Created <em>{{ project.created_ts | date("F j, Y") }}</em></p>
          </td>
        </tr>
      </table>
    </div>
    <div class="well-list">
      <table class="table table-condensed">
        <tr>
          <th>
            <h2>
              Contributors
              {% if admin %}
                <div class="pull-right">
                  <a href="#addContributor" rel="tooltip" title="Add new collaborator" class="rawlink" data-toggle="modal">
                    <i class="icon-plus"></i>
                  </a>
                </div>
              {% endif %}
            </h2>
          </th>
        </tr>
        {% for perm in perms %}
          <tr>
            <td class="tabular" valign="middle">
              {{ anchor("/users/profile/#{perm.user_id}", perm.username) | raw }}
              <div class="buttons">
                <div class="button">
                  {% if perm.permission b-and 8 %}
                    <i class="icon-wrench"></i>
                  {% else %}
                    <i class="icon-edit"></i>
                  {% endif %}
                </div>
              </div>
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>
  <div class="span8">
    {% include 'projects/changes_list.twig' %}
  </div>
</div>

{% endblock %}
