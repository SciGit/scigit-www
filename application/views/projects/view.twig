{% extends "base.twig" %}

{% block title project.name %}

{% block content %}

<div class="page-header">
  <div class="pull-right">
    {% if admin %}
      <a class="butn butn-large butn-primary title-btn" href="{{ site_url("/projects/admin/#{project.id}") | raw }}">
        <i class="icon-wrench icon-white"></i>
        Admin
      </a>
    {% elseif not member %}
      {{ form_open("/projects/subscribe/#{project.id}") | raw }}
        {{ form_input({class: 'hidden', name: 'return_to', value: 'view'}) | raw }}
        {{ form_submit({class: subscribed ? 'btn btn-large btn-danger' : 'btn btn-large btn-success', name: 'subscribe'},
            subscribed ? 'Unsubscribe' : 'Subscribe') | raw }}
      {{ form_close() | raw }}
    {% endif %}
  </div>
	<h2>
    <p class="breadcrumbs">
      {{ anchor("/", "Home") | raw }} <span class="divider">&gt;</span>
      {% if member or admin %}
        {{ anchor("/projects", "My Projects") | raw }} <span class="divider">&gt;</span>
      {% else %}
        {{ anchor("/projects/explore", "Public") | raw }} <span class="divider">&gt;</span>
      {% endif %}
      <span class="current">{{ anchor("/projects/view/#{project.id}", project.name) | raw }}</span>
    </p>
	</h2>
</div>

<div class="row-fluid">
  <div class="span4">
    <div class="blue-well-list">
      <table class="table table-condensed">
        <tr>
          <th>
            <h2>Description</h2>
          </th>
        </tr>
        <tr class="nohover">
          <td class="tabular" valign="middle">
            <p>
              {% if project.description %}
                {{ word_wrap(project.description, 30) }}
              {% else %}
                <p>This project has no description.</p>
              {% endif %}
            </p>
          </td>
        </tr>
      </table>
    </div>
    <div class="well-list">
      <table class="table table-condensed">
        <tr>
          <th>
            <h2>Stats</h2>
          </th>
        </tr>
        <tr class="nohover">
          <td class="tabular" valign="middle">
            <table width="100%">
              <tr>
                <td>
                  <p><i class="icon-star"></i>&nbsp;<strong>{{ subscribers }}</strong> Subscribers</p>
                </td>
                <td>
                  <p><i class="icon-circle-arrow-up"></i>&nbsp;<strong>{{ changes_num }}</strong> Changes</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><i class="icon-edit"></i>&nbsp;<strong>{{ contributors }}</strong> Contributors</p>
                </td>
                <td>
                  <p><i class="icon-wrench"></i>&nbsp;<strong>{{ administrators }}</strong> Administrators</p>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr class="alwayshover">
          <td>
            Created <em>{{ project.created_ts | date("F j, Y") }}</em></p>
          </td>
        </tr>
      </table>
    </div>
    <div class="well-list">
      <table class="table table-condensed">
        <tr>
          <th>
            <h2>Contributors</h2>
          </th>
        </tr>
        {% for perm in perms %}
          <tr>
            <td class="tabular" valign="middle">
              {{ anchor("/users/profile/#{perm.user_id}", perm.username) | raw }}
              <div class="buttons">
                <div class="button">
                  {% if perm.permission b-and 8 %}
                    <i class="icon-wrench"></i>
                  {% else %}
                    <i class="icon-edit"></i>
                  {% endif %}
                </div>
              </div>
            </td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>
  <div class="span8 well-list">
    <table class="table table-condensed">
      <tr>
        <th>
          <h2>
            Recent Changes
            {% if changes %}
              <div class="pull-right">
                <a class="btn title-btn" href="{{ site_url("/projects/changes/#{project.id}") | raw }}">
                  <i class="icon-circle-arrow-up"></i>
                  View all
                </a>
              </div>
            {% endif %}
          </h2>
        </th>
      </tr>
      {% if changes %}
        {% for change in changes %}
          <tr>
            <td class="change" valign="middle" data-change_id="{{ change.id }}">
              {{ anchor("/users/profile/#{change.user_id}", change.username) | raw }} made change:
              <div class="pull-right">
                <span class="date">{{ time_ago(change.commit_ts) }}</span>
              </div>
              <div class="description">
                {{ anchor("/changes/view/#{change.id}", change.commit_msg) | raw }}
              </div>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <p>This project has no recent changes.</p>
      {% endif %}
    </table>
  </div>
</div>

{% endblock %}
