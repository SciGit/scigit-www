{% extends "base.twig" %}

{% block title %}
My Projects
{% endblock %}

{% block content %}

<script>
$(document).ready(function() {
  $('.unsubscribe').click(function(e) { e.preventDefault() });
});

function unsubscribe(link) {
  var form_data = {
    proj_id : link.getAttribute('data-subid')
  };

  $.ajax({
    url: "subscribe_ajax",
    type: "POST",
    data: form_data,
    dataType: "json",
    cache: false,

    success: function(json) {
      if (json.error == 0) {
        window.location.href = window.location.href;
      }
    }
  })
}
</script>

<p class="breadcrumbs">
  {{ anchor("/", "Home") | raw }} <span class="divider">&gt;</span>
  <span class="current">{{ anchor("/projects/me", "My Projects") | raw }}</span>
</p>

<div class="separator-xsmall"></div>

<div class="page-header">
  <h1>Manage Projects</h1>
</div>

<div class="row-fluid">
  <div class="span6 blue-well-list">
    <table class="table table-hover">
      <tr>
        <th>
          <h2>
            My Projects
            <div class="pull-right">
              <a href="#createProject" class="btn btn-large btn-valign" data-toggle="modal">
                <i class="icon-plus"> Create New</i>
              </a>
            </div>
          </h2>
        </th>
      </tr>
      {% if projects %}
        {% for project in projects %}
          <tr>
            <td class="project" valign="middle" data-proj_id="{{ project.id }}">
              <div class="title">
                {{ anchor("/projects/view/#{project.id}", project.name) | raw }}
              </div>
              <div class="buttons">
                <div class="button">
                  <a href="#" rel="tooltip" title="Subscribers" class="rawlink">
                    {{ project.subscribers }}
                    <i class="icon-star"></i>
                  </a>
                </div>
                {% if project.permission b-and 8 %}
                  <div class="button">
                    <a href="{{ site_url("/projects/admin/#{project.id}", 'Admin') | raw }}" rel="tooltip" title="Administrate" class="rawlink">
                      <i class="icon-cog icon-large"></i>
                    </a>
                  </div>
                {% endif %}
              </div>
              <div class="description">
                {% if project.description %}
                  {{ project.description | slice(0, 120) }} ...
                {% else %}
                  No description.
                {% endif %}
              </div>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr class="nohover">
          <td valign="middle">
            <p>You don't have access to any projects.
            <a href="#createProject" rel="tooltip" title="Create new project" data-toggle="modal">Create a Project</a> or have someone add you to one.</p>
          </td>
        </tr>
      {% endif %}
    </table>
  </div>

  <div class="span6 well-list">
    <table class="table table-hover">
      <tr>
        <th>
          <h2>
            Subscriptions
            <div class="pull-right">
              <a href="/projects/explore" class="btn btn-large btn-valign">
                <i class="icon-bookmark"></i> View Public
              </a>
            </div>
          </h2>
        </th>
      </tr>
      {% if subscriptions %}
        {% for subscription in subscriptions %}
          <tr>
            <td class="project" valign="middle" data-proj_id="{{ subscription.id }}">
              <div class="title">
                {{ anchor("/projects/view/#{subscription.id}", subscription.name) | raw }}
              </div>
              <div class="buttons">
                <div class="button">
                  <a href="#" rel="tooltip" title="Subscribers" class="rawlink">
                    {{ subscription.subscribers }}
                    <i class="icon-star"></i>
                  </a>
                </div>
                <div class="button">
                  <a href="#" onclick="unsubscribe(this)" class="unsubscribe rawlink" data-subid="{{ subscription.id }}" rel="tooltip" title="Cancel Subscription">
                    <i class="icon-ban-circle icon-large"></i>
                  </a>
                </div>
              </div>
              <div class="description">
                {% if project.description %}
                  {{ project.description | slice(0, 120) }} ...
                {% else %}
                  No description.
                {% endif %}
              </div>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr class="nohover">
          <td valign="middle">
            <p>You have no subscriptions. Visit the {{ anchor("/projects/explore", "Explore") | raw }} section for some suggestions!</p>
          </td>
        </tr>
      {% endif %}
    </table>
  </div>
</div>

<div class="separator"></div>

{% endblock %}
