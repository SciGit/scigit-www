<script>
$(document).ready(function() {
  $('#createProject').submit(createProject);
});

function createProject(event) {
  event.preventDefault();

  var form_data = {
    name : $("[name='name']").val(),
    public : $("[name='public']").val(),
  };

  $.ajax({
    url: "create_ajax",
    type: "POST",
    data: form_data,
    dataType: "json",
    cache: false,

    success: function (json) {
      if (json.error == 0) {
        $('#createProjectError').hide();
        $('#createProjectSuccess').html(json.message).show();
        setTimeout(function() {
          var waitingReload = true;
          $('#createProject').modal('hide');
          $('#createProject').on('hidden', function() {
            if (waitingReload) {
              window.location.href = window.location.href;
            }
          });
        }, 1500);
      } else {
        $('#createProjectError').html(json.message).show();
      }
    }
  });
}
</script>

<div id="createProject" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Create New Project</h3>
  </div>
  {{ form_open('') | raw }}
  <div class="modal-body">
    <div id="createProjectError" class="alert alert-error hide"></div>
    <div id="createProjectSuccess" class="alert alert-success hide"></div>
    <div class="row-fluid center">
      <div class="span6">
        {{ form_label('Project Name', 'name') | raw }}
        {{ form_input('name', set_value('name')) | raw }} <br />
      </div>
      <div class="span2">
        {{ form_label('Make Public', 'public') | raw }}
        {{ form_checkbox('public', 1, set_value('public')) | raw }}
      </div>
    </div>
  </div>
  <div class="modal-footer">
    {{ form_submit({class: 'butn butn-primary', name: 'create_project'}, 'Create') | raw }}
    <a class="butn" data-dismiss="modal">Cancel</a>
  </div>
  {{ form_close() | raw }}
</div>
